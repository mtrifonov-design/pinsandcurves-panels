var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});(function(){"use strict";function n(n2,e2){var t2=typeof Symbol=="function"&&n2[Symbol.iterator];if(!t2)return n2;var a2,r2,i2=t2.call(n2),o2=[];try{for(;(e2===void 0||e2-- >0)&&!(a2=i2.next()).done;)o2.push(a2.value)}catch(n3){r2={error:n3}}finally{try{a2&&!a2.done&&(t2=i2.return)&&t2.call(i2)}finally{if(r2)throw r2.error}}return o2}__name(n,"n");function e(n2,e2,t2){if(arguments.length===2)for(var a2,r2=0,i2=e2.length;r2<i2;r2++)!a2&&r2 in e2||(a2||(a2=Array.prototype.slice.call(e2,0,r2)),a2[r2]=e2[r2]);return n2.concat(a2||Array.prototype.slice.call(e2))}__name(e,"e");function t(e2,t2,a2){var r2=n(e2,2),i2=r2[0],o2=r2[1],u2=n(t2,2),l2=u2[0],s2=u2[1],c2=n(a2,2),f2=c2[0],p2=c2[1],d2=(i2-l2)*(i2-f2)*(l2-f2);return d2===0?{a:0,b:0,c:0}:{a:(o2*(l2-f2)+s2*(f2-i2)+p2*(i2-l2))/d2,b:(o2*(Math.pow(f2,2)-Math.pow(l2,2))+s2*(Math.pow(i2,2)-Math.pow(f2,2))+p2*(Math.pow(l2,2)-Math.pow(i2,2)))/d2,c:(o2*(l2*f2*(l2-f2))+s2*(f2*i2*(f2-i2))+p2*(i2*l2*(i2-l2)))/d2}}__name(t,"t"),typeof SuppressedError=="function"&&SuppressedError;var a=__name(function(n2){var e2=n2.project,a2=n2.project.orgData.signalIdByPinId[n2.pinId],r2=e2.signalData[a2].pinIds.indexOf(n2.pinId);return r2===0?n2.range[0]:(r2-1)%2===0?function(n3){var e3=n3.project,a3=n3.project.orgData.signalIdByPinId[n3.pinId],r3=e3.signalData[a3].pinIds,i2=r3.indexOf(n3.pinId);if(i2===0)return n3.previousPinValue;if(i2===r3.length-1)return n3.nextPinValue;var o2=r3[i2-1],u2=r3[i2+1],l2=t([e3.signalData[a3].pinTimes[o2],e3.signalData[a3].pinValues[o2]],[n3.nextPinTime,n3.nextPinValue],[e3.signalData[a3].pinTimes[u2],e3.signalData[a3].pinValues[u2]]),s2=l2.a,c2=l2.b,f2=l2.c,p2=n3.frame,d2=s2*p2*p2+c2*p2+f2;return isNaN(d2)?n3.nextPinValue:d2}(n2):function(n3){var e3=n3.project,a3=n3.project.orgData.signalIdByPinId[n3.pinId],r3=e3.signalData[a3].pinIds,i2=r3.indexOf(n3.pinId);if(i2<2)return n3.previousPinValue;var o2=r3[i2-1],u2=r3[i2-2],l2=e3.signalData[a3].pinTimes[o2],s2=e3.signalData[a3].pinValues[o2],c2=n3.nextPinTime,f2=n3.nextPinValue,p2=t([e3.signalData[a3].pinTimes[u2],e3.signalData[a3].pinValues[u2]],[l2,s2],[c2,f2]),d2=p2.a,m2=p2.b,v2=p2.c,g2=n3.frame,y2=d2*g2*g2+m2*g2+v2;return isNaN(y2)?n3.nextPinValue:y2}(n2)},"a"),r=function(t2){var a2,r2=((a2=t2%2147483647)<=0&&(a2+=2147483646),function(){return((a2=16807*a2%2147483647)-1)/2147483646}),i2=Array(256).fill(0).map(function(){return 2*r2()-1}),o2=Array(256).fill(0).map(function(n2,e2){return e2}).sort(function(){return r2()-.5}),u2=e(e([],n(o2),!1),n(o2),!1);return function(n2){var e2,t3=255&Math.floor(n2),a3=n2-Math.floor(n2),r3=(e2=a3)*e2*e2*(e2*(6*e2-15)+10);return function(n3,e3,t4){return n3+t4*(e3-n3)}(i2[u2[t3]]*a3,i2[u2[t3+1]]*(a3-1),r3)}}(42);function i(n2,e2,t2){return n2+(e2-n2)*t2}__name(i,"i");function o(n2){return n2*n2*n2}__name(o,"o");function u(n2){return 1-Math.pow(1-n2,3)}__name(u,"u");function l(n2){return n2<.5?4*n2*n2*n2:1-Math.pow(-2*n2+2,3)/2}__name(l,"l");function s(n2){var e2=2*Math.PI/3;return n2===0?0:n2===1?1:Math.pow(2,-10*n2)*Math.sin((10*n2-.75)*e2)+1}__name(s,"s");var c={};function f(n2,e2){n2 in c||(c[n2]=e2)}__name(f,"f");function p(n2){return n2 in c?c[n2]:null}__name(p,"p");function d(e2){var t2=e2.nextPinTime,c2=e2.project,d2=e2.range,m2=e2.defaultValue,v2=e2.pinId,g2=e2.frame,y2=e2.numberOfFrames,x2=e2.framesPerSecond,h2=e2.nextPinValue,I=e2.previousPinTime,P=e2.previousPinValue,V=e2.relativeTime,b=e2.interpolateSignalValueAtTime,w=n(d2,2),S=w[0],T=w[1];return{nextPinTime:t2,nextPinValue:h2,project:c2,previousPinTime:I,defaultValue:m2,previousPinValue:P,relativeTime:V,frame:g2,pinId:v2,numberOfFrames:y2,framesPerSecond:x2,maxValue:T,minValue:S,linearInterpolation:i,easeInCubic:o,easeOutCubic:u,easeInOutCubic:l,easeOutElastic:s,easyLinear:__name(function(){return V*(h2-P)+P},"easyLinear"),bezier:__name(function(){var a2=c2.orgData.signalIdByPinId[e2.pinId],r2=c2.signalData[a2];if(r2&&"bezier"in r2){var i2=n(r2.bezierControlPoints[e2.pinId],2);i2[0];var u2=i2[1];u2+=h2;var l2=r2.pinIds.indexOf(e2.pinId)-1;l2=l2<0?0:l2;var s2=r2.pinIds[l2],f2=n(r2.bezierControlPoints[s2],4);f2[0],f2[1],f2[2];var d3=f2[3];return function(n2,e3,t3,a3,r3){var i3=n2.y,o2=e3.y,u3=t3.y,l3=a3.y;return function(n3){return Math.pow(1-n3,3)*i3+3*Math.pow(1-n3,2)*n3*o2+3*(1-n3)*Math.pow(n3,2)*u3+Math.pow(n3,3)*l3}(r3)}({y:P},{y:d3+=P},{y:u2},{y:h2},V)}return m2},"bezier"),easyStep:__name(function(){return h2},"easyStep"),easyEaseIn:__name(function(){return P+o(V)*(h2-P)},"easyEaseIn"),easyEaseOut:__name(function(){return P+u(V)*(h2-P)},"easyEaseOut"),easyEase:__name(function(){return P+l(V)*(h2-P)},"easyEase"),easyEaseOutElastic:__name(function(){return P+s(V)*(h2-P)},"easyEaseOutElastic"),easyInOut:__name(function(){return 1},"easyInOut"),noise:r,easyThreshold:__name(function(){return h2>(T-S)/2?T:S},"easyThreshold"),easyRepeat:__name(function(){return V},"easyRepeat"),easyParabola:__name(function(){return a(e2)},"easyParabola"),interpolateSignalValueAtTime:b,signal:__name(function(n2){return b(n2,g2)},"signal"),cloneSignal:__name(function(n2){var e3=c2.orgData.signalIds.find(function(e4){return c2.orgData.signalNames[e4]===n2});if(!e3)throw new Error("Signal ".concat(n2," not found"));var t3=c2.signalData[e3];if(!t3)throw new Error("Signal ".concat(n2," not found"));var a2=t3.pinIds;if(a2.length<2)return m2;var r2=t3.pinTimes[a2[0]],i2=t3.pinTimes[a2[a2.length-1]];return b(n2,r2+(i2-r2)*V)},"cloneSignal"),fitSignal:__name(function(n2,e3,t3){var a2=c2.orgData.signalIds.find(function(e4){return c2.orgData.signalNames[e4]===n2});if(!a2)throw new Error("Signal ".concat(n2," not found"));var r2=e3??S,i2=t3??T,o2=c2.signalData[a2].range;return r2+(b(n2,g2)-o2[0])/(o2[1]-o2[0])*(i2-r2)},"fitSignal"),flip:__name(function(n2){return T-n2+S},"flip"),useAsset:p,saveAsset:f}}__name(d,"d");var m={},v={},g=1e-6,y=__name(function(t2,a2,r2,i2){var o2=t2.signalData[a2],u2=n(o2.range,2),l2=u2[0],s2=u2[1],c2=o2.defaultValue,f2=Object.entries(o2.pinTimes).sort(function(n2,e2){return n2[1]-e2[1]}),p2=f2.find(function(e2){var t3=n(e2,2);return t3[0],t3[1]>=r2});if(p2===void 0)return[c2,[]];var y2,x2=n(p2,2),I=x2[0],P=x2[1],V=o2.pinValues[I],b=o2.curves[I],w=l2,S=0,T=f2.findIndex(function(e2){var t3=n(e2,2),a3=t3[0];return t3[1],a3===I});if(T>0){var D=n(f2[T-1],2),E=D[0],O=D[1];w=o2.pinValues[E],S=O}else if(r2<P)return[c2,[]];var M=v[a2+I];if(M===void 0||M.functionString!==b){var j=`
            let nextPinTime = context.nextPinTime;
            let nextPinValue = context.nextPinValue;
            let previousPinTime = context.previousPinTime;
            let previousPinValue = context.previousPinValue;
            let relativeTime = context.relativeTime;
            let frame = context.frame;
            let numberOfFrames = context.numberOfFrames;
            let framesPerSecond = context.framesPerSecond;

            let interpolateSignalValue = context.interpolateSignalValue;
            let signal = context.signal;

            let bezier = context.bezier;

            let easyLinear = context.easyLinear;
            let easyEaseIn = context.easyEaseIn;
            let easyEaseOut = context.easyEaseOut;
            let easyStep = context.easyStep;
            let easyEase = context.easyEase;
            let easyEaseOutElastic = context.easyEaseOutElastic;
            let easyRepeat = context.easyRepeat;
            let easyThreshold = context.easyThreshold;
            let easyParabola = context.easyParabola;
            let easyInOut = context.easyInOut;
            let noise = context.noise;
            let fitSignal = context.fitSignal;
            let flip = context.flip;
            let cloneSignal = context.cloneSignal;


            `.concat(b);y2=new Function("context","templates",j),v[a2+I]={functionString:b,cachedFunction:y2}}else y2=M.cachedFunction;var F=(r2-S)/(P!==S?P-S:1),N=c2,A=[];try{var z=d({nextPinTime:P,nextPinValue:V,previousPinTime:S,project:t2,previousPinValue:w,defaultValue:c2,relativeTime:F,pinId:I,frame:r2,range:[l2,s2],numberOfFrames:t2.timelineData.numberOfFrames,framesPerSecond:t2.timelineData.framesPerSecond,interpolateSignalValueAtTime:__name(function(a3,r3){var o3=t2.orgData.signalIds.find(function(n2){return t2.orgData.signalNames[n2]===a3});if(o3===void 0)throw new Error("Signal not found");var u3=n(h(t2,o3,r3,i2),2),l3=u3[0],s3=u3[1];if(typeof l3=="string")throw new Error("Interpolation function returned string");return A.push.apply(A,e([],n(s3),!1)),l3},"interpolateSignalValueAtTime")}),C=function(e2){var t3={};return Object.entries(e2.templateData).forEach(function(e3){var a3=n(e3,2),r3=a3[0],i3=a3[1];if(m[r3]!==void 0){if(m[r3].functionString===i3){var o3=m[r3].cachedFunction;return void(t3[r3]=o3)}}else o3=new Function("return ".concat(i3,";"))(),t3[r3]=o3,m[r3]={functionString:i3,cachedFunction:o3}}),t3}(t2);N=y2(z,C)}catch(n2){A.push({signalId:a2,frame:r2,error:n2.message})}if(isNaN(N)&&(N=c2,A.push({signalId:a2,frame:r2,error:"Interpolated value is NaN"})),N<l2&&(N=l2,Math.abs(N-l2)>g&&A.push({signalId:a2,frame:r2,error:"Interpolated value below minimum"})),N>s2){var B=N;N=s2,Math.abs(B-s2)>g&&A.push({signalId:a2,frame:r2,error:"Interpolated value above maximum: "+B})}return[N,A]},"y"),x=__name(function(e2,t2,a2,r2){var i2=e2.signalData[t2],o2=i2.defaultValue,u2=Object.entries(i2.pinTimes).sort(function(n2,e3){return n2[1]-e3[1]}).find(function(e3){var t3=n(e3,2);return t3[0],t3[1]>=a2});if(u2===void 0)return o2;var l2=n(u2,2),s2=l2[0];return l2[1],i2.pinValues[s2]},"x"),h=__name(function(n2,e2,t2,a2){if(a2===void 0&&(a2=0),++a2>1e3)throw new Error("Exceeded maximum iteration count");var r2=n2.timelineData.numberOfFrames;if(t2<0||t2>r2)throw new Error("Time out of range");var i2=n2.signalData[e2].type;if(i2==="discrete")return[x(n2,e2,t2),[]];if(i2==="continuous")return y(n2,e2,t2,a2);throw new Error("Invalid signal type")},"h");self.onmessage=function(n2){var e2=n2.data,t2=e2.id,a2=e2.object,r2=a2.project,i2=a2.signalId,o2=a2.frameArray.map(function(n3){return h(r2,i2,n3)});self.postMessage({id:t2,result:o2})}})();
