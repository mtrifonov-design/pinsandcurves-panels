(function(){"use strict";function v(e,t){var a=typeof Symbol=="function"&&e[Symbol.iterator];if(!a)return e;var u,n,o=a.call(e),i=[];try{for(;(t===void 0||t-- >0)&&!(u=o.next()).done;)i.push(u.value)}catch(r){n={error:r}}finally{try{u&&!u.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}function L(e,t,a){if(arguments.length===2)for(var u,n=0,o=t.length;n<o;n++)!u&&n in t||(u||(u=Array.prototype.slice.call(t,0,n)),u[n]=t[n]);return e.concat(u||Array.prototype.slice.call(t))}function G(e,t,a){var u=v(e,2),n=u[0],o=u[1],i=v(t,2),r=i[0],f=i[1],l=v(a,2),c=l[0],s=l[1],p=(n-r)*(n-c)*(r-c);return p===0?{a:0,b:0,c:0}:{a:(o*(r-c)+f*(c-n)+s*(n-r))/p,b:(o*(Math.pow(c,2)-Math.pow(r,2))+f*(Math.pow(n,2)-Math.pow(c,2))+s*(Math.pow(r,2)-Math.pow(n,2)))/p,c:(o*(r*c*(r-c))+f*(c*n*(c-n))+s*(n*r*(n-r)))/p}}typeof SuppressedError=="function"&&SuppressedError;var Y=function(e){var t=e.project,a=e.project.orgData.signalIdByPinId[e.pinId],u=t.signalData[a].pinIds.indexOf(e.pinId);return u===0?e.range[0]:(u-1)%2===0?function(n){var o=n.project,i=n.project.orgData.signalIdByPinId[n.pinId],r=o.signalData[i].pinIds,f=r.indexOf(n.pinId);if(f===0)return n.previousPinValue;if(f===r.length-1)return n.nextPinValue;var l=r[f-1],c=r[f+1],s=G([o.signalData[i].pinTimes[l],o.signalData[i].pinValues[l]],[n.nextPinTime,n.nextPinValue],[o.signalData[i].pinTimes[c],o.signalData[i].pinValues[c]]),p=s.a,g=s.b,D=s.c,h=n.frame,P=p*h*h+g*h+D;return isNaN(P)?n.nextPinValue:P}(e):function(n){var o=n.project,i=n.project.orgData.signalIdByPinId[n.pinId],r=o.signalData[i].pinIds,f=r.indexOf(n.pinId);if(f<2)return n.previousPinValue;var l=r[f-1],c=r[f-2],s=o.signalData[i].pinTimes[l],p=o.signalData[i].pinValues[l],g=n.nextPinTime,D=n.nextPinValue,h=G([o.signalData[i].pinTimes[c],o.signalData[i].pinValues[c]],[s,p],[g,D]),P=h.a,m=h.b,d=h.c,y=n.frame,x=P*y*y+m*y+d;return isNaN(x)?n.nextPinValue:x}(e)},Z=function(e){var t,a=((t=e%2147483647)<=0&&(t+=2147483646),function(){return((t=16807*t%2147483647)-1)/2147483646}),u=Array(256).fill(0).map(function(){return 2*a()-1}),n=Array(256).fill(0).map(function(i,r){return r}).sort(function(){return a()-.5}),o=L(L([],v(n),!1),v(n),!1);return function(i){var r,f=255&Math.floor(i),l=i-Math.floor(i),c=(r=l)*r*r*(r*(6*r-15)+10);return function(s,p,g){return s+g*(p-s)}(u[o[f]]*l,u[o[f+1]]*(l-1),c)}}(42);function _(e,t,a){return e+(t-e)*a}function H(e){return e*e*e}function J(e){return 1-Math.pow(1-e,3)}function K(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}function Q(e){var t=2*Math.PI/3;return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*t)+1}var z={};function $(e,t){e in z||(z[e]=t)}function ee(e){return e in z?z[e]:null}function ne(e){var t=e.nextPinTime,a=e.project,u=e.range,n=e.defaultValue,o=e.pinId,i=e.frame,r=e.numberOfFrames,f=e.framesPerSecond,l=e.nextPinValue,c=e.previousPinTime,s=e.previousPinValue,p=e.relativeTime,g=e.interpolateSignalValueAtTime,D=v(u,2),h=D[0],P=D[1];return{nextPinTime:t,nextPinValue:l,project:a,previousPinTime:c,defaultValue:n,previousPinValue:s,relativeTime:p,frame:i,pinId:o,numberOfFrames:r,framesPerSecond:f,maxValue:P,minValue:h,linearInterpolation:_,easeInCubic:H,easeOutCubic:J,easeInOutCubic:K,easeOutElastic:Q,easyLinear:function(){return p*(l-s)+s},bezier:function(){var m=a.orgData.signalIdByPinId[e.pinId],d=a.signalData[m];if(d&&"bezier"in d){var y=v(d.bezierControlPoints[e.pinId],2);y[0];var x=y[1];x+=l;var w=d.pinIds.indexOf(e.pinId)-1;w=w<0?0:w;var j=d.pinIds[w],V=v(d.bezierControlPoints[j],4);V[0],V[1],V[2];var N=V[3];return function(R,S,E,k,q){var B=R.y,b=S.y,I=E.y,M=k.y;return function(T){return Math.pow(1-T,3)*B+3*Math.pow(1-T,2)*T*b+3*(1-T)*Math.pow(T,2)*I+Math.pow(T,3)*M}(q)}({y:s},{y:N+=s},{y:x},{y:l},p)}return n},easyStep:function(){return l},easyEaseIn:function(){return s+H(p)*(l-s)},easyEaseOut:function(){return s+J(p)*(l-s)},easyEase:function(){return s+K(p)*(l-s)},easyEaseOutElastic:function(){return s+Q(p)*(l-s)},easyInOut:function(){return 1},noise:Z,easyThreshold:function(){return l>(P-h)/2?P:h},easyRepeat:function(){return p},easyParabola:function(){return Y(e)},interpolateSignalValueAtTime:g,signal:function(m){return g(m,i)},cloneSignal:function(m){var d=a.orgData.signalIds.find(function(V){return a.orgData.signalNames[V]===m});if(!d)throw new Error("Signal ".concat(m," not found"));var y=a.signalData[d];if(!y)throw new Error("Signal ".concat(m," not found"));var x=y.pinIds;if(x.length<2)return n;var w=y.pinTimes[x[0]],j=y.pinTimes[x[x.length-1]];return g(m,w+(j-w)*p)},fitSignal:function(m,d,y){var x=a.orgData.signalIds.find(function(N){return a.orgData.signalNames[N]===m});if(!x)throw new Error("Signal ".concat(m," not found"));var w=d??h,j=y??P,V=a.signalData[x].range;return w+(g(m,i)-V[0])/(V[1]-V[0])*(j-w)},flip:function(m){return P-m+h},useAsset:ee,saveAsset:$}}var C={},U={},W=1e-6,te=function(e,t,a,u){var n=e.signalData[t],o=v(n.range,2),i=o[0],r=o[1],f=n.defaultValue,l=Object.entries(n.pinTimes).sort(function(b,I){return b[1]-I[1]}),c=l.find(function(b){var I=v(b,2);return I[0],I[1]>=a});if(c===void 0)return[f,[]];var s,p=v(c,2),g=p[0],D=p[1],h=n.pinValues[g],P=n.curves[g],m=i,d=0,y=l.findIndex(function(b){var I=v(b,2),M=I[0];return I[1],M===g});if(y>0){var x=v(l[y-1],2),w=x[0],j=x[1];m=n.pinValues[w],d=j}else if(a<D)return[f,[]];var V=U[t+g];if(V===void 0||V.functionString!==P){var N=`
            let nextPinTime = context.nextPinTime;
            let nextPinValue = context.nextPinValue;
            let previousPinTime = context.previousPinTime;
            let previousPinValue = context.previousPinValue;
            let relativeTime = context.relativeTime;
            let frame = context.frame;
            let numberOfFrames = context.numberOfFrames;
            let framesPerSecond = context.framesPerSecond;

            let interpolateSignalValue = context.interpolateSignalValue;
            let signal = context.signal;

            let bezier = context.bezier;

            let easyLinear = context.easyLinear;
            let easyEaseIn = context.easyEaseIn;
            let easyEaseOut = context.easyEaseOut;
            let easyStep = context.easyStep;
            let easyEase = context.easyEase;
            let easyEaseOutElastic = context.easyEaseOutElastic;
            let easyRepeat = context.easyRepeat;
            let easyThreshold = context.easyThreshold;
            let easyParabola = context.easyParabola;
            let easyInOut = context.easyInOut;
            let noise = context.noise;
            let fitSignal = context.fitSignal;
            let flip = context.flip;
            let cloneSignal = context.cloneSignal;


            `.concat(P);s=new Function("context","templates",N),U[t+g]={functionString:P,cachedFunction:s}}else s=V.cachedFunction;var R=(a-d)/(D!==d?D-d:1),S=f,E=[];try{var k=ne({nextPinTime:D,nextPinValue:h,previousPinTime:d,project:e,previousPinValue:m,defaultValue:f,relativeTime:R,pinId:g,frame:a,range:[i,r],numberOfFrames:e.timelineData.numberOfFrames,framesPerSecond:e.timelineData.framesPerSecond,interpolateSignalValueAtTime:function(b,I){var M=e.orgData.signalIds.find(function(F){return e.orgData.signalNames[F]===b});if(M===void 0)throw new Error("Signal not found");var T=v(X(e,M,I,u),2),O=T[0],A=T[1];if(typeof O=="string")throw new Error("Interpolation function returned string");return E.push.apply(E,L([],v(A),!1)),O}}),q=function(b){var I={};return Object.entries(b.templateData).forEach(function(M){var T=v(M,2),O=T[0],A=T[1];if(C[O]!==void 0){if(C[O].functionString===A){var F=C[O].cachedFunction;return void(I[O]=F)}}else F=new Function("return ".concat(A,";"))(),I[O]=F,C[O]={functionString:A,cachedFunction:F}}),I}(e);S=s(k,q)}catch(b){E.push({signalId:t,frame:a,error:b.message})}if(isNaN(S)&&(S=f,E.push({signalId:t,frame:a,error:"Interpolated value is NaN"})),S<i&&(S=i,Math.abs(S-i)>W&&E.push({signalId:t,frame:a,error:"Interpolated value below minimum"})),S>r){var B=S;S=r,Math.abs(B-r)>W&&E.push({signalId:t,frame:a,error:"Interpolated value above maximum: "+B})}return[S,E]},ae=function(e,t,a,u){var n=e.signalData[t],o=n.defaultValue,i=Object.entries(n.pinTimes).sort(function(l,c){return l[1]-c[1]}).find(function(l){var c=v(l,2);return c[0],c[1]>=a});if(i===void 0)return o;var r=v(i,2),f=r[0];return r[1],n.pinValues[f]},X=function(e,t,a,u){if(u===void 0&&(u=0),++u>1e3)throw new Error("Exceeded maximum iteration count");var n=e.timelineData.numberOfFrames;if(a<0||a>n)throw new Error("Time out of range");var o=e.signalData[t].type;if(o==="discrete")return[ae(e,t,a),[]];if(o==="continuous")return te(e,t,a,u);throw new Error("Invalid signal type")};self.onmessage=function(e){var t=e.data,a=t.id,u=t.object,n=u.project,o=u.signalId,i=u.frameArray.map(function(r){return X(n,o,r)});self.postMessage({id:a,result:i})}})();
